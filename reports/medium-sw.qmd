---
title: "Dive visualization"
format: html
editor_options: 
  chunk_output_type: console
---

Start with loading and plotting the dive data:

```{r}

library(tidyverse)
library(gridExtra)
library(zoo)

depth <- read_csv(here::here("data/23A1302/out-Archive.csv"), 
                  show_col_types = FALSE) %>% 
  drop_na(Depth) %>% 
  mutate(Date = as.POSIXct(Time, format = "%H:%M:%S %d-%b-%Y", tz = "UTC")) %>% 
  rename(no_zoc_depth = Depth,
         Depth = `Corrected Depth`)

ggplot(depth, aes(Date, Depth)) +
  geom_line(linewidth = 0.03) +
  scale_y_reverse() +
  theme_bw()

```

Functions for dive summary statistics

```{r}

#turn the continuous dive record into individual dives and calculate summary stats for each dive. 

source(here::here("R/dives.R"))

dives <- get_dives(depth, 5, 80)
dive_stats <- summarize_dives(dives)

```

Filter dives to only when we had recordings.

```{r}
recording <- read.csv(here::here("data/wav_timestamps.csv")) %>% 
  mutate(start = ymd_hms(start_time, tz = "UTC"),
         end = ymd_hms(end_time, tz = "UTC")) %>% 
  drop_na(end)

recording_start <- recording$start[1]
recording_end <- last(recording$end)

dives <- dives %>% 
  filter(between(Date, recording_start, recording_end))

```

Generate images for dive typing.

```{r}
source(here::here("R/dive_type_plots.R"))

#Plots were generated and saved to outputs folder 

# walk(unique(dives$dive_id), 
#      \(fd) dive_type_plot(dives, fd, -2:2))

```

Example output:

![](images/dive2208.png)

To fix: put the actual date at the bottom, and not just the time; add an option to fix the scale of the y axis so that it is easier to make comparisons across dives.
